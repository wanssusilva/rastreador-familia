<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: sans-serif; }
        #map { height: 70vh; width: 100%; }
        .controls { padding: 15px; background: white; text-align: center; }
        input, button { width: 90%; padding: 12px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { background: #28a745; color: white; font-weight: bold; border: none; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="controls">
        <input type="text" id="nome" placeholder="Seu Nome (ex: Mae)">
        <button onclick="ativar()">ATIVAR MONITORAMENTO 24H</button>
        <p id="msg">Aguardando...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // SUBSTITUA PELOS SEUS DADOS DO FIREBASE ABAIXO:
        var config = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            appId: "SEU_APP_ID"
        };
        firebase.initializeApp(config);
        var db = firebase.database();

        var map = L.map('map').setView([-23.5, -46.6], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var markers = {};

        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        function ativar() {
            var nome = document.getElementById('nome').value;
            if(!nome) return alert("Digite seu nome!");
            
            document.getElementById('msg').innerText = "Rastreando 24h ativo...";

            navigator.geolocation.watchPosition(function(pos) {
                var lat = pos.coords.latitude;
                var lng = pos.coords.longitude;
                var status = (pos.coords.speed > 0.5) ? "Em Movimento" : "Parado";

                db.ref('familia/' + nome).set({
                    lat: lat, lng: lng, status: status, hora: new Date().toLocaleTimeString()
                });
                map.setView([lat, lng], 16);
            }, null, { enableHighAccuracy: true });
        }

        db.ref('familia').on('value', function(snap) {
            var dados = snap.val();
            for(var id in dados) {
                if(markers[id]) { markers[id].setLatLng([dados[id].lat, dados[id].lng]); }
                else { markers[id] = L.marker([dados[id].lat, dados[id].lng]).addTo(map).bindPopup(id); }
            }
        });
    </script>
</body>
</html>
